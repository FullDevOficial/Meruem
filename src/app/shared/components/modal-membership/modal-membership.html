<app-modal-generic 
  [isOpen]="isOpen"
  [title]="isValidating ? '' : groupName"
  [showBanner]="!isValidating"
  [bannerText]="'Para participar do grupo, preencha os campos abaixo.'"
  [showFooter]="false"
  [showHeader]="!isValidating"
  (close)="onClose()"
  [size]="isValidating ? 'md' : 'lg'">
  
  <!-- Loading/Validação -->
  @if (isValidating) {
    <app-loading-validation></app-loading-validation>
  }

  <!-- Conteúdo do Modal -->
  @if (!isValidating) {
  <div slot="body" class="modal-content">
    <!-- Campo Nome -->
    <div class="input-group">
      <label class="input-label">Nome:</label>
      <mat-form-field appearance="outline" class="full-width">
        <input matInput 
               placeholder="Insira seu nome" 
               [formControl]="nomeControl"
               type="text">
        <mat-error *ngIf="isFieldInvalid(nomeControl)">
          {{ getFieldErrorMessage(nomeControl, 'Nome') }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Campo Telefone -->
    <div class="input-group">
      <label class="input-label">Número:</label>
      <div class="phone-input-container">
        <mat-form-field appearance="outline" class="phone-country">
          <input matInput 
                 [formControl]="paisControl"
                 placeholder="+55"
                 type="tel"
                 appCountryCodeMask
                 maxlength="4">
          <mat-error *ngIf="isFieldInvalid(paisControl)">
            {{ getFieldErrorMessage(paisControl, 'País') }}
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline" class="phone-number">
          <input matInput 
                 placeholder="(21) 9 88460135" 
                 [formControl]="telefoneControl"
                 type="tel"
                 appPhoneMask
                 maxlength="15">
          <mat-icon matSuffix>phone</mat-icon>
          <mat-error *ngIf="isFieldInvalid(telefoneControl)">
            {{ getFieldErrorMessage(telefoneControl, 'Telefone') }}
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <!-- Checkbox de termos -->
    <div class="checkbox-container">
      <mat-checkbox [formControl]="termosControl">
        Concordo com os termos de usuário
      </mat-checkbox>
    </div>

    <!-- Botão de confirmação -->
    <button 
      class="confirm-button-modal" 
      (click)="onConfirm()"
      [disabled]="!isFormValid()">
      {{ confirmButtonText }}
    </button>
  </div>
  }
</app-modal-generic>

<!-- Modal de Sucesso -->
<app-modal-success
  [isOpen]="showSuccess"
  [title]="'Pronto!'"
  [message]="'Você foi adicionado ao grupo ' + groupName + ' com sucesso.'"
  [primaryButtonText]="'Acessar'"
  [secondaryButtonText]="'Fechar'"
  (close)="onSuccessClose()"
  (primaryAction)="onAccessGroup()">
</app-modal-success>
